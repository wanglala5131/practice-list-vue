(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7b6b990c"],{"1afd":function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("main",[i("BackgroundImg"),i("div",[i("loading",{attrs:{active:e.isProcessing},on:{"update:active":function(t){e.isProcessing=t}}})],1),i("CardForm",{attrs:{"ori-categories":e.categories,"ori-subcategories":e.subcategories,"is-loading":e.isLoading,"is-processing":e.isProcessing},on:{submitFile:e.submitFileHandler}},[e._v("新增項目")])],1)},a=[],s=(i("96cf"),i("1da1")),o=i("afb4"),n=i("b1ab"),c=i("a240"),u=i("ce50"),m=i("2fa3"),l={name:"CreateItem",components:{BackgroundImg:o["a"],CardForm:n["a"]},data:function(){return{isProcessing:!1,isLoading:!0,categories:[],subcategories:[],subcategoryFilter:[],item:{name:"",limit:"",description:"",image:"",CategoryId:-1,subCategories:[],subcategoriesArr:[]}}},created:function(){this.fetchCategories()},methods:{fetchCategories:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var i,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,c["a"].getSubcategory();case 3:if(i=t.sent,r=i.data,a=i.statusText,"OK"===a){t.next=8;break}throw new Error;case 8:e.categories=r.categories,e.subcategories=r.subcategories,e.isLoading=!1,t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](0),m["b"].fire({icon:"error",title:"目前無法取得運動項目與運動類別，請稍後再試"});case 16:case"end":return t.stop()}}),t,null,[[0,13]])})))()},submitFileHandler:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function i(){var r,a,s;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,t.isProcessing=!0,i.next=4,u["a"].addItem({formData:e});case 4:if(r=i.sent,a=r.data,s=r.statusText,"OK"===s){i.next=9;break}throw new Error;case 9:if("error"!==a.status){i.next=13;break}return m["b"].fire({icon:"error",title:a.message}),t.isProcessing=!1,i.abrupt("return");case 13:m["b"].fire({icon:"success",title:"成功建立項目"}),t.$router.push("/items/".concat(a.newItem.id)),i.next=21;break;case 17:i.prev=17,i.t0=i["catch"](0),t.isProcessing=!1,m["b"].fire({icon:"error",title:"目前暫時無法新增項目，請稍後再試"});case 21:case"end":return i.stop()}}),i,null,[[0,17]])})))()}}},g=l,d=(i("6ab1"),i("2877")),f=Object(d["a"])(g,r,a,!1,null,"69da779f",null);t["default"]=f.exports},"39ba":function(e,t,i){},"6ab1":function(e,t,i){"use strict";var r=i("c052"),a=i.n(r);a.a},b1ab:function(e,t,i){"use strict";var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container card-form-container"},[i("form",{staticClass:"card-form",on:{submit:function(t){return t.stopPropagation(),t.preventDefault(),e.submitFile(t)}}},[i("h2",{staticClass:"form-title"},[e._t("default")],2),i("div",[i("loading",{attrs:{id:"loading-box",active:e.isLoading,"can-cancel":!0,opacity:e.opacity},on:{"update:active":function(t){e.isLoading=t}}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLoading,expression:"!isLoading"}],staticClass:"form-content"},[i("div",{staticClass:"form-item form-name"},[i("label",{attrs:{for:"name"}},[e._v("項目名稱*：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.item.name,expression:"item.name"}],attrs:{type:"text",name:"name",id:"name",required:""},domProps:{value:e.item.name},on:{input:function(t){t.target.composing||e.$set(e.item,"name",t.target.value)}}})]),i("div",{staticClass:"form-item form-category"},[i("label",{attrs:{for:"category"}},[e._v("運動種類*：")]),i("select",{directives:[{name:"model",rawName:"v-model",value:e.item.CategoryId,expression:"item.CategoryId"}],staticClass:"category",attrs:{name:"CategoryId",id:"category",required:""},on:{change:[function(t){var i=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.item,"CategoryId",t.target.multiple?i:i[0])},e.filterSubcategory]}},[i("option",{attrs:{value:"-1",hidden:"",disabled:""}},[e._v("請選擇")]),e._l(e.categories,(function(t){return i("option",{key:t.id,domProps:{value:t.id}},[e._v(e._s(t.name))])}))],2)]),i("div",{staticClass:"form-item form-subcategory"},[i("p",[e._v("運動類別*：")]),i("div",{staticClass:"form-subcategory-wrapper"},e._l(e.subcategoryFilter,(function(t){return i("div",{key:t.id,staticClass:"subcategory-box"},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.item.subcategoriesArr,expression:"item.subcategoriesArr"}],attrs:{type:"checkbox",id:e.labelIndex(t.id),name:"subcategoriesArr"},domProps:{value:t.id,checked:Array.isArray(e.item.subcategoriesArr)?e._i(e.item.subcategoriesArr,t.id)>-1:e.item.subcategoriesArr},on:{change:function(i){var r=e.item.subcategoriesArr,a=i.target,s=!!a.checked;if(Array.isArray(r)){var o=t.id,n=e._i(r,o);a.checked?n<0&&e.$set(e.item,"subcategoriesArr",r.concat([o])):n>-1&&e.$set(e.item,"subcategoriesArr",r.slice(0,n).concat(r.slice(n+1)))}else e.$set(e.item,"subcategoriesArr",s)}}}),i("label",{attrs:{for:e.labelIndex(t.id)}},[e._v(e._s(t.name))])])})),0)]),i("div",{staticClass:"form-item form-limit"},[i("label",{attrs:{for:"limit"}},[e._v("限制：")]),i("input",{directives:[{name:"model",rawName:"v-model",value:e.item.limit,expression:"item.limit"}],attrs:{type:"text",name:"limit",id:"limit"},domProps:{value:e.item.limit},on:{input:function(t){t.target.composing||e.$set(e.item,"limit",t.target.value)}}})]),i("div",{staticClass:"form-item form-description"},[i("label",{attrs:{for:"description"}},[e._v("項目描述：")]),i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.item.description,expression:"item.description"}],attrs:{name:"description",id:"description"},domProps:{value:e.item.description},on:{input:function(t){t.target.composing||e.$set(e.item,"description",t.target.value)}}})]),i("div",{staticClass:"form-item form-image"},[i("p",{attrs:{for:"image"}},[e._v("相關圖片：")]),i("input",{ref:"inputFile",attrs:{type:"file",name:"image"},on:{change:e.fileChangeHandler}}),i("div",{staticClass:"form-item-image"},[i("img",{directives:[{name:"show",rawName:"v-show",value:e.item.image,expression:"item.image"}],attrs:{src:e.item.image,alt:"image"}})])])]),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLoading,expression:"!isLoading"}],staticClass:"form-buttons"},[i("router-link",{staticClass:"form-button go-back-button",attrs:{to:"/"}},[e._v(" 回首頁 ")]),e.oriImage?i("button",{staticClass:"form-button delete-image-button",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.deleteImage(e.item.id)}}},[e._v(" 只刪除圖片 ")]):e._e(),i("button",{staticClass:"form-button card-submit-button",attrs:{type:"submit",disabled:e.isProcessing}},[e._v(" "+e._s(e.isProcessing?"送出中":"送出表單")+" ")])],1)])])},a=[],s=(i("4de4"),i("caad"),i("b0c0"),i("d3b7"),i("3ca3"),i("ddb0"),i("2b3d"),i("96cf"),i("1da1")),o=i("2fa3"),n=i("ce50"),c={name:"CardForm",data:function(){return{opacity:0,subcategoryFilter:[],item:{image:"",CategoryId:-1},oriImage:void 0,categories:[],subcategories:[]}},props:{oriCategories:{type:Array},oriSubcategories:{type:Array},oriItem:{type:Object},isProcessing:{type:Boolean},isLoading:{type:Boolean},formTtpe:{type:String}},methods:{filterSubcategory:function(){var e=this;this.item.subcategoriesArr=[],this.subcategoryFilter=this.subcategories.filter((function(t){return t.CategoryId===e.item.CategoryId}))},labelIndex:function(e){return"subcategory-".concat(e)},fileChangeHandler:function(e){var t=e.target.files,i=["image/jpeg","image/png"];if(!i.includes(t[0].type))return o["b"].fire({icon:"error",title:"只能傳圖片唷！"}),this.item.image="",void(this.$refs.inputFile.value="");if(t.length){var r=window.URL.createObjectURL(t[0]);this.item.image=r}else this.item.image=""},submitFile:function(e){var t=this;if(!this.item.name||this.item.CategoryId<0||0===this.item.subcategoriesArr.length)o["b"].fire({icon:"error",title:"必填欄位要記得填哦！"});else{var i=e.target,r=new FormData(i);o["a"].fire({title:"確定要送出了嗎？若有上傳圖片會花較久時間，請見諒",confirmButtonText:"送出"}).then((function(e){e.isConfirmed&&t.$emit("submitFile",r)}))}},deleteImage:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function i(){var r,a,s,c;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,o["a"].fire({title:"確定要刪除圖片嗎？",confirmButtonText:"確定"});case 3:if(r=i.sent,!r.isConfirmed){i.next=17;break}return i.next=7,n["a"].deleteItemImage({itemId:e});case 7:if(a=i.sent,s=a.data,c=a.statusText,"OK"===c){i.next=12;break}throw new Error;case 12:if("error"!==s.status){i.next=15;break}return o["b"].fire({icon:"error",title:s.message}),i.abrupt("return");case 15:o["b"].fire({icon:"success",title:"已成功刪除圖片"}),t.$router.push("/items/".concat(e));case 17:i.next=22;break;case 19:i.prev=19,i.t0=i["catch"](0),o["b"].fire({icon:"error",title:"目前無法刪除圖片，請稍後再試"});case 22:case"end":return i.stop()}}),i,null,[[0,19]])})))()}},watch:{oriCategories:function(e){this.categories=e},oriSubcategories:function(e){var t=this;this.subcategories=e,0===this.subcategoryFilter.length&&-1!==this.item.CategoryId&&(this.subcategoryFilter=e.filter((function(e){return e.CategoryId===t.oriItem.CategoryId})))},oriItem:function(e){var t=this;this.item=e,this.oriImage=e.image,0===this.subcategoryFilter.length&&0!==this.subcategories.length&&(this.subcategoryFilter=this.subcategories.filter((function(e){return e.CategoryId===t.oriItem.CategoryId})))}}},u=c,m=(i("ec73"),i("2877")),l=Object(m["a"])(u,r,a,!1,null,null,null);t["a"]=l.exports},c052:function(e,t,i){},ec73:function(e,t,i){"use strict";var r=i("39ba"),a=i.n(r);a.a}}]);
//# sourceMappingURL=chunk-7b6b990c.8bb1b46f.js.map