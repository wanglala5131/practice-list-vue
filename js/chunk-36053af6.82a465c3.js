(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-36053af6"],{"211e":function(e,t,r){},"2f27":function(e,t,r){"use strict";var i=r("211e"),a=r.n(i);a.a},"39ba":function(e,t,r){},4047:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("main",[r("BackgroundImg"),r("div",[r("loading",{attrs:{active:e.isProcessing},on:{"update:active":function(t){e.isProcessing=t}}})],1),r("CardForm",{attrs:{"ori-categories":e.categories,"ori-subcategories":e.subcategories,"ori-item":e.item,"is-processing":e.isProcessing,"is-loading":e.isLoading,"form-type":"edit"},on:{submitFile:e.submitFileHandler}},[e._v("修改項目")])],1)},a=[],s=(r("d81d"),r("5530")),n=(r("96cf"),r("1da1")),o=r("afb4"),c=r("b1ab"),u=r("a240"),m=r("ce50"),l=r("2fa3"),g={name:"EditItem",components:{BackgroundImg:o["a"],CardForm:c["a"]},data:function(){return{isLoading:!0,isProcessing:!1,categories:[],subcategories:[],item:{}}},created:function(){var e=this.$route.params.id;this.fetchItem(e),this.fetchCategories()},methods:{fetchCategories:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){var r,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,u["a"].getSubcategory();case 3:if(r=t.sent,i=r.data,a=r.statusText,"OK"===a){t.next=8;break}throw new Error;case 8:e.categories=i.categories,e.subcategories=i.subcategories,e.isLoading=!1,t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](0),l["b"].fire({icon:"error",title:"目前無法取得運動項目與運動類別，請稍後再試"});case 16:case"end":return t.stop()}}),t,null,[[0,13]])})))()},fetchItem:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var i,a,n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,m["a"].getItem({itemId:e});case 3:if(i=r.sent,a=i.data,n=i.statusText,"OK"===n){r.next=8;break}throw new Error;case 8:if("error"!==a.status){r.next=11;break}return l["b"].fire({icon:"error",title:a.message}),r.abrupt("return");case 11:return o=[],a.item.Subcategories.map((function(e){o.push(e.id)})),t.item=Object(s["a"])(Object(s["a"])({},a.item),{},{subcategoriesArr:o}),r.abrupt("return");case 17:r.prev=17,r.t0=r["catch"](0),l["b"].fire({icon:"error",title:"目前無法取得項目資料，請稍後再試"});case 20:case"end":return r.stop()}}),r,null,[[0,17]])})))()},submitFileHandler:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var i,a,s,n,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,t.isProcessing=!0,i=t.item.id,r.next=5,m["a"].putItem({itemId:i,formData:e});case 5:if(a=r.sent,s=a.data,n=a.statusText,"OK"===n){r.next=10;break}throw new Error;case 10:if("error"!==s.status){r.next=14;break}return l["b"].fire({icon:"error",title:s.message}),t.isProcessing=!1,r.abrupt("return");case 14:l["b"].fire({icon:"success",title:"成功編輯項目"}),o=s.updateItem,t.$router.push("/items/".concat(o.id)),r.next=24;break;case 19:r.prev=19,r.t0=r["catch"](0),t.isProcessing=!1,console.log(r.t0),l["b"].fire({icon:"error",title:"目前暫時無法編輯項目，請稍後再試"});case 24:case"end":return r.stop()}}),r,null,[[0,19]])})))()}}},d=g,f=(r("2f27"),r("2877")),b=Object(f["a"])(d,i,a,!1,null,"6554d9a0",null);t["default"]=b.exports},b1ab:function(e,t,r){"use strict";var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container card-form-container"},[r("form",{staticClass:"card-form",on:{submit:function(t){return t.stopPropagation(),t.preventDefault(),e.submitFile(t)}}},[r("h2",{staticClass:"form-title"},[e._t("default")],2),r("div",[r("loading",{attrs:{id:"loading-box",active:e.isLoading,"can-cancel":!0,opacity:e.opacity},on:{"update:active":function(t){e.isLoading=t}}})],1),r("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLoading,expression:"!isLoading"}],staticClass:"form-content"},[r("div",{staticClass:"form-item form-name"},[r("label",{attrs:{for:"name"}},[e._v("項目名稱*：")]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.item.name,expression:"item.name"}],attrs:{type:"text",name:"name",id:"name",required:""},domProps:{value:e.item.name},on:{input:function(t){t.target.composing||e.$set(e.item,"name",t.target.value)}}})]),r("div",{staticClass:"form-item form-category"},[r("label",{attrs:{for:"category"}},[e._v("運動種類*：")]),r("select",{directives:[{name:"model",rawName:"v-model",value:e.item.CategoryId,expression:"item.CategoryId"}],staticClass:"category",attrs:{name:"CategoryId",id:"category",required:""},on:{change:[function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.item,"CategoryId",t.target.multiple?r:r[0])},e.filterSubcategory]}},[r("option",{attrs:{value:"-1",hidden:"",disabled:""}},[e._v("請選擇")]),e._l(e.categories,(function(t){return r("option",{key:t.id,domProps:{value:t.id}},[e._v(e._s(t.name))])}))],2)]),r("div",{staticClass:"form-item form-subcategory"},[r("p",[e._v("運動類別*：")]),r("div",{staticClass:"form-subcategory-wrapper"},e._l(e.subcategoryFilter,(function(t){return r("div",{key:t.id,staticClass:"subcategory-box"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.item.subcategoriesArr,expression:"item.subcategoriesArr"}],attrs:{type:"checkbox",id:e.labelIndex(t.id),name:"subcategoriesArr"},domProps:{value:t.id,checked:Array.isArray(e.item.subcategoriesArr)?e._i(e.item.subcategoriesArr,t.id)>-1:e.item.subcategoriesArr},on:{change:function(r){var i=e.item.subcategoriesArr,a=r.target,s=!!a.checked;if(Array.isArray(i)){var n=t.id,o=e._i(i,n);a.checked?o<0&&e.$set(e.item,"subcategoriesArr",i.concat([n])):o>-1&&e.$set(e.item,"subcategoriesArr",i.slice(0,o).concat(i.slice(o+1)))}else e.$set(e.item,"subcategoriesArr",s)}}}),r("label",{attrs:{for:e.labelIndex(t.id)}},[e._v(e._s(t.name))])])})),0)]),r("div",{staticClass:"form-item form-limit"},[r("label",{attrs:{for:"limit"}},[e._v("限制：")]),r("input",{directives:[{name:"model",rawName:"v-model",value:e.item.limit,expression:"item.limit"}],attrs:{type:"text",name:"limit",id:"limit"},domProps:{value:e.item.limit},on:{input:function(t){t.target.composing||e.$set(e.item,"limit",t.target.value)}}})]),r("div",{staticClass:"form-item form-description"},[r("label",{attrs:{for:"description"}},[e._v("項目描述：")]),r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.item.description,expression:"item.description"}],attrs:{name:"description",id:"description"},domProps:{value:e.item.description},on:{input:function(t){t.target.composing||e.$set(e.item,"description",t.target.value)}}})]),r("div",{staticClass:"form-item form-image"},[r("p",{attrs:{for:"image"}},[e._v("相關圖片：")]),r("input",{ref:"inputFile",attrs:{type:"file",name:"image"},on:{change:e.fileChangeHandler}}),r("div",{staticClass:"form-item-image"},[r("img",{directives:[{name:"show",rawName:"v-show",value:e.item.image,expression:"item.image"}],attrs:{src:e.item.image,alt:"image"}})])])]),r("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLoading,expression:"!isLoading"}],staticClass:"form-buttons"},[r("router-link",{staticClass:"form-button go-back-button",attrs:{to:"/"}},[e._v(" 回首頁 ")]),e.oriImage?r("button",{staticClass:"form-button delete-image-button",on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.deleteImage(e.item.id)}}},[e._v(" 只刪除圖片 ")]):e._e(),r("button",{staticClass:"form-button card-submit-button",attrs:{type:"submit",disabled:e.isProcessing}},[e._v(" "+e._s(e.isProcessing?"送出中":"送出表單")+" ")])],1)])])},a=[],s=(r("4de4"),r("caad"),r("b0c0"),r("d3b7"),r("3ca3"),r("ddb0"),r("2b3d"),r("96cf"),r("1da1")),n=r("2fa3"),o=r("ce50"),c={name:"CardForm",data:function(){return{opacity:0,subcategoryFilter:[],item:{image:"",CategoryId:-1},oriImage:void 0,categories:[],subcategories:[]}},props:{oriCategories:{type:Array},oriSubcategories:{type:Array},oriItem:{type:Object},isProcessing:{type:Boolean},isLoading:{type:Boolean},formTtpe:{type:String}},methods:{filterSubcategory:function(){var e=this;this.item.subcategoriesArr=[],this.subcategoryFilter=this.subcategories.filter((function(t){return t.CategoryId===e.item.CategoryId}))},labelIndex:function(e){return"subcategory-".concat(e)},fileChangeHandler:function(e){var t=e.target.files,r=["image/jpeg","image/png"];if(!r.includes(t[0].type))return n["b"].fire({icon:"error",title:"只能傳圖片唷！"}),this.item.image="",void(this.$refs.inputFile.value="");if(t.length){var i=window.URL.createObjectURL(t[0]);this.item.image=i}else this.item.image=""},submitFile:function(e){var t=this;if(!this.item.name||this.item.CategoryId<0||0===this.item.subcategoriesArr.length)n["b"].fire({icon:"error",title:"必填欄位要記得填哦！"});else{var r=e.target,i=new FormData(r);n["a"].fire({title:"確定要送出了嗎？若有上傳圖片會花較久時間，請見諒",confirmButtonText:"送出"}).then((function(e){e.isConfirmed&&t.$emit("submitFile",i)}))}},deleteImage:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var i,a,s,c;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,n["a"].fire({title:"確定要刪除圖片嗎？",confirmButtonText:"確定"});case 3:if(i=r.sent,!i.isConfirmed){r.next=17;break}return r.next=7,o["a"].deleteItemImage({itemId:e});case 7:if(a=r.sent,s=a.data,c=a.statusText,"OK"===c){r.next=12;break}throw new Error;case 12:if("error"!==s.status){r.next=15;break}return n["b"].fire({icon:"error",title:s.message}),r.abrupt("return");case 15:n["b"].fire({icon:"success",title:"已成功刪除圖片"}),t.$router.push("/items/".concat(e));case 17:r.next=22;break;case 19:r.prev=19,r.t0=r["catch"](0),n["b"].fire({icon:"error",title:"目前無法刪除圖片，請稍後再試"});case 22:case"end":return r.stop()}}),r,null,[[0,19]])})))()}},watch:{oriCategories:function(e){this.categories=e},oriSubcategories:function(e){var t=this;this.subcategories=e,0===this.subcategoryFilter.length&&-1!==this.item.CategoryId&&(this.subcategoryFilter=e.filter((function(e){return e.CategoryId===t.oriItem.CategoryId})))},oriItem:function(e){var t=this;this.item=e,this.oriImage=e.image,0===this.subcategoryFilter.length&&0!==this.subcategories.length&&(this.subcategoryFilter=this.subcategories.filter((function(e){return e.CategoryId===t.oriItem.CategoryId})))}}},u=c,m=(r("ec73"),r("2877")),l=Object(m["a"])(u,i,a,!1,null,null,null);t["a"]=l.exports},ec73:function(e,t,r){"use strict";var i=r("39ba"),a=r.n(i);a.a}}]);
//# sourceMappingURL=chunk-36053af6.82a465c3.js.map